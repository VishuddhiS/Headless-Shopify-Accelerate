{"version":3,"file":"index.es.js","sources":["../src/composables/useContent.ts","../src/composables/renderContent.ts"],"sourcesContent":["import { useContentFactory, UseContent, Context } from '@vue-storefront/core'\nimport { ContentSearchParams } from '../types'\n\nconst search = async (context: Context, params: ContentSearchParams): Promise<{}> =>\n  await context.$cntf.api.getContent(params)\nconst useContent: (cacheId: string) => UseContent<any, ContentSearchParams> = useContentFactory<\n  any,\n  ContentSearchParams\n>({ search })\n\nexport { useContent }\n","import { RenderComponent } from '@vue-storefront/core'\nimport { Logger } from '@vue-storefront/core'\nimport { Image, MappedImage } from '../types'\n\nconst extractNestedItem = (item) => (item.fields ? item.fields : item)\n\nconst supportCompose = (item) => ({\n  ...item,\n  component: item.content.fields.component,\n  content: item.content.fields.content,\n})\n\nexport const getImageObject = ({ fields, metadata }: Image): MappedImage => ({\n  url: fields.file.url,\n  alt: fields.title,\n  metadata: {\n    ...metadata,\n    width: fields.file.details.image.width,\n    height: fields.file.details.image.height,\n    size: fields.file.details.size,\n    format: fields.file.contentType,\n  },\n})\n\nconst filterProps = ['sys', '_meta']\n\nexport const extractComponents = (items: any[]): RenderComponent[] => {\n  if (!items || !items.length) {\n    Logger.error('No content items provided for render')\n    return []\n  }\n  return items.map((item) => {\n    item = extractNestedItem(item)\n    if (!(item.content instanceof Array) && !item.component && item.seo) {\n      item = supportCompose(item)\n    }\n    return {\n      componentName: item.component,\n      props: ((data) => {\n        filterProps.forEach((prop) => delete data[prop])\n        if (data.image) {\n          data.image = getImageObject(data.image)\n        }\n        if (data.images && Array.isArray(data.images)) {\n          data.images = data.images.map(getImageObject)\n        }\n        if (data.content && Array.isArray(data.content)) {\n          data.content = data.content.map(extractNestedItem)\n        }\n        if (data.items && Array.isArray(data.items)) {\n          data.items = data.items.map((subItem) => {\n            subItem = extractNestedItem(subItem)\n            if (subItem.image && subItem.image.fields) {\n              subItem.image = getImageObject(subItem.image)\n            }\n            return subItem\n          })\n        }\n\n        if (data.component) {\n          delete data.component\n        }\n        return data\n      })(JSON.parse(JSON.stringify(item))),\n    }\n  })\n}\n"],"names":[],"mappings":"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"}